# [WIP]コントロールの入力形式による類型

> [!WARNING]
> この記事は執筆中です

## はじめに

入力コントロールについて、ユーザーの操作方法による分類を試みる。

Web画面におけるユーザーの入力は、基本的にはキーボードでの入力とマウスでの選択（またはキーボードコマンド、マウス操作にマッピングされるタッチ操作など）によって行われる。入力コントロールを、ユーザー操作の観点から分類すると、次のような分類が考えられる。

* Editor Control: ユーザーが値を編集する
* Selector Control: ユーザーが値を選択する
  * Set Selector Control: 任意の集合(Set)の範囲から値を選択する
  * Option Selector Control: あらかじめ与えられた選択肢(Option)の中から値を選択する
* 上記の複合

これらのコントロールが持つべき性質を検討し、設計観点を明らかにすることを試みる。

設計観点は、次のようなものが考えられる。

* 取り扱うデータ型
* イベント
* 表示のフォーマット
* 入力制限
  * 入力の制限
  * バリデーションによる制限


## Editor Control

Editor Controlは、ユーザーが値を編集(Edit)するためのコントロールである。主にキーボードを使用して文字列を入力する。

規定のHTMLコントロールでは、`input[type=text]`がこれに該当する。他にも、`textarea`や`input[type=password]`なども含まれる。`input[type=number]`や`input[type=date]`などもEditor Controlだが、スピナーやカレンダーで値を選択できる場合があり、これはSet Selector Controlとの複合コントロールであるといえる。

### 扱うデータ型

基本は文字列型となる。ただし、内部で適切に変換できる場合、他の方のデータを扱うこともできる。

#### 文字列





----
reject

## Writer Control

主にキーボードなどを使用し、文字列を入力されるコントロール。入力前に選択肢をセットしない点でSelector Controlと対比される。ただし、要件に応じて入力値な文字や形式、桁数を制限することはある。

### 扱うデータ型

#### 文字列

文字列が基本。最もシンプルな形は完全なフリー入力だが、必要に応じて使用可能文字や桁数に制限をかける 。

#### その他プリミティブ

他のプリミティブでは、文字列から変換可能な数値もよく取り扱う。bool値も取り扱えるが、一般的ではない。Symbolはその特殊性から不可能だろう。null, undefinedも普通扱わない。

#### オブジェクト

`input[type=date]`のようにオブジェクトを扱うことも可能。より汎用的には、JSON形式の文字列を入力してObjectとして取り扱うこともできる。文字列とシリアライズ/パース可能であれば取り扱えるといえる。ただし、変換に失敗した場合の取り扱いを検討する必要がある。

### 入力方法

#### キーボード

最も基本的な入力方法。ほとんどの入力をカバーできる。IMEの挙動には環境差があるため注意する必要がある。

#### マウス

入力補助UIを使用する場合にはマウスで入力することがある。スピナーやカレンダーなど。

#### クリップボード

コピペ機能を使用して入力することもある。特に、ファイルパスやURLなどの長い文字列を入力する場合に有用。キーボード入力と同様に受け入れる必要があるが、キーボードが１文字ずつイベントを発生させるのに対し、クリップボードは一度に大量の文字列を受け取る可能性があるため、その処理には注意が必要。

#### その他のデバイス

音声入力、画像認識、バーコードリーダーなど、その他の入力デバイスを使用することもある。

### 入力の制限

選択肢の制限はしないが、要件に応じて入力値の制限をかける。

#### 文字種の制限

入力可能な文字種を制限することがある。例えば、数字のみ、アルファベットのみ、記号のみなど。数値入力コンポーネントは数値および数値表現のための記号のみを受け入れるこ例である。

文字種の制限を入力モードの制限として実装することもできるが、IMEはこの制限を突破することが多い。バリデーションによる制限を併用することが望ましい。

#### 桁数の制限

入力可能な桁数を制限することがある。電話番号や郵便番号など、桁数が固定されているものに対しては桁数制限をかけることが多い。データベースカラムの制限のために桁数制限をかけることもある。数値項目で桁数制限をかける例もあるが、数値であれば桁数制限をかけるよりも数値の範囲を制限するべきだろう。ただし、実数の場合は小数部に桁数制限をかける必要があるかもしれない。

桁数の制限は実装による制限が可能だが、IMEが突破する例がある。バリデーションによる制限を併用することが望ましい。

#### フォーマットの制限

入力値のフォーマットを制限することがある。例えば、日付のフォーマットや電話番号のフォーマットなど。オブジェクトと互換の文字列はパース可能なフォーマットである必要がある。
業務固有のコード値を入力する場合も必要だが、そのような値はSelector Componentの使用も検討すべきだろう。

フォーマットの制限は実装による制限が難しい。バリデーションによる制限を併用することが望ましい。

### バリデーション

入力の制限やフォーマットチェックのため、バリデーションを行うことが多い。

### 表示のフォーマット

内部値とは別に、表示用のフォーマットを持つことがある。

* 日付の内部値は`Date`オブジェクトであるが、表示用のフォーマットは`YYYY/MM/DD`とする
* 数値の内部値は`number`であるが、表示用のフォーマットはカンマ区切りとする
* 電話番号の内部値は連続した数字文字列であるが、表示用のフォーマットは`XXX-XXXX-XXXX`とする

などがある。

表示用のフォーマット文字列はあくまで表示用であり、フォームモデルに渡るべきではない。

### Readonly

`input[type=text]`をはじめとするWeb標準のWriter Controlは、Readonly属性を持つ。これは入力を受け付けないが、コントロールは有効であり、フォームモデルから認識され、フォーカスを受け付けるなど、入力以外は有効な状態である。(これに対して、`input[type=text]`の`disabled`属性はコントロールそのものが無効な状態である。)


### コントロールの例


## Selector Control

あらかじめ制限されたオプションリストの中から値を選択するコントロール

### 選択数による区別

オプションセットの中から一つを選ぶSingle Selectorと、複数地を選択可能なMulti Selectorに分けられる。

### 取り扱うデータ型

#### 任意のデータ型

Single Selectorでは任意のデータ型をリストにして選択させることができる。リスト間のデータ型が異なっても良いが、扱いにくいので普通は統一する。

#### bool値

Single Selectorの最もシンプルな形式として、bool値を`true`/`false`のセットとして選択させる。

#### 配列

Multi Selectorでは、選択された複数の値を配列として取り扱う。配列の要素の型は任意である。

### オプションインターフェース

選択肢は、選択肢自体としての値と、選択肢の内容をユーザーに提示するためのラベルが必要となる。そのため、選択肢を表現するための`Option`インターフェースは次のような形式になる。

```typescript
interface Option<T> {
  value: T,
  label: string
}
```

コントロールの要件によっては追加のプロパティが必要になるが、その場合は`Option`インターフェースを継承する。例えば、multi selectorで初期の選択状態を表現するために`sselected`プロパティを必要とする場合、次のようになる。

```typescript
interface MultiOption<T> extends Option<T> {
  selected: boolean
}
```

### 選択の通知

`Option`オブジェクトはSelector Controlの表示のためのオブジェクトであり、業務モデルの入力状態を反映したフォームモデルにバインドすべきではない（バインドしてもいいが、変換を必要とする）。モデルにはあくまで業務モデル上の値（`Option.value`）をバインドする。一方、選択された`Option`オブジェクトそのものを必要とするユースケースのために、選択が変更されたことを通知するイベントを実装し、選択された`Option`オブジェクトをイベントオブジェクトとして渡すべきだろう。Multi Selectorの場合、選択状態を反映した`Option`リストを通知する形になる。イベントとしては、標準の選択系htmlコントロールでは`change`イベントが一般的であるので、それに類したイベント名がいいだろう。`select`イベントはテキストボックス等でカーソル選択されたことを通知するイベントなので注意。

### バリデーション

あらかじめ選択肢を設定する都合上、Selector Controlではバリデーションはあまり必要とされない。必須選択であればRequiredバリデーションをかけることがある。また、フォームモデルに対してプログラマブルに値を設定できる都合上、選択範囲外の値を設定されていないかのチェックは考えられる。ただし、ユーザーにはどうしようもないため、エラー処理の範疇かもしれない。

### Readonly

HTML標準の`input[type=radio]`や`select`はReadonly属性を持たない。これはReadonlyが値の"編集"を抑止する機能であり、値を"選択"しているに過ぎないSelector Controlでは意味がないためである。
Selector ControlでReadonly的な動作をさせる場合、選択値のみを表示させるべきだろう。

### コントロールの例

## 特殊なコントロール

ファイル選択

## バインドするオブジェクトの備えるべき要件の検討
